{"version":3,"file":"imagebuddy.browser.min.js","sources":["webpack:///imagebuddy.browser.min.js"],"sourcesContent":["/**\n * imagebuddy\n *\n * @version v1.1.1\n * @link https://github.com/dougfrei/imagebuddy\n * @license ISC\n *\n */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=1)}([function(e,t){function n(e){return(n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var r=function(){function e(e){void 0===e&&(e=!1),this.enabled=e}var t=e.prototype;return t.debug=function(){var e;this.enabled&&(e=console).log.apply(e,[].slice.call(arguments))},t.debugInfo=function(){var e;this.enabled&&(e=console).info.apply(e,[].slice.call(arguments))},t.debugTable=function(){var e;this.enabled&&(e=console).table.apply(e,[].slice.call(arguments))},e}(),o={},s=function(){function e(){}return e.on=function(e,t){\"object\"!=n(o[e])&&(o[e]=[]),o[e].push(t)},e.emit=function(e){var t=[].slice.call(arguments,1);setTimeout((function(){if(\"object\"==n(o[e]))for(var i=o[e].slice(),r=0;r<i.length;r++)i[r].apply(null,t)}),0)},e}();function a(e){var t=e.trim().toLowerCase();return\"true\"===t||\"false\"!==t&&parseInt(t,10)>0}function u(){return void 0!==window.pageYOffset?window.pageYOffset:(document.scrollingElement||document.documentElement).scrollTop}function l(e){return e.getBoundingClientRect().top+u()}function d(e){return e.trim()?e.split(\",\").map((function(e){var t=e.trim().split(\" \"),n=t[2];return{url:t[0],width:parseInt(t[1],10),height:parseInt(n,10)}})).sort((function(e,t){return e.width>=e.height?e.width>t.width?1:-1:e.height>t.height?1:-1})):[]}function c(e){return!!e&&!e.hasAttribute(\"data-ib-no-cache\")&&!!e.getAttribute(\"data-ib-cache-id\")}function h(e){return e.hasAttribute(\"data-ib-ignore\")}function f(e,t){void 0===t&&(t=!1);var n={width:\"block\"===(e.style.display?e.style.display:window.getComputedStyle(e).display)?e.clientWidth:0,height:e.clientHeight?e.clientHeight:0};return!n.width&&e.parentElement&&(n.width=function e(t){return\"block\"!==(t.style.display?t.style.display:window.getComputedStyle(t).display)&&t.parentElement?e(t.parentElement):t.clientWidth}(e.parentElement)),t&&(n.height=0),n}var p=function(){function e(e,t,n){e.classList.add(t.classes.base),e.setAttribute(\"data-ib-cache-id\",Math.random().toString(36).substring(7)),this.el=e,this.config=t,this.elType=e.tagName.toLowerCase(),this.sizes=d(e.getAttribute(t.attributes.sources)||\"\"),this.currentSize={width:0,height:0},this.loaded=!1,this.isLoading=!1,this.options={lazyLoad:e.hasAttribute(t.attributes.lazyLoad)?a(e.getAttribute(t.attributes.lazyLoad)||\"\"):n.lazyLoad,lazyLoadThreshold:e.hasAttribute(t.attributes.lazyLoadThreshold)?parseInt(e.getAttribute(t.attributes.lazyLoadThreshold)||\"0\",10):n.lazyLoadThreshold,matchDPR:e.hasAttribute(t.attributes.matchDPR)?a(e.getAttribute(t.attributes.matchDPR)||\"\"):n.matchDPR,noHeight:!!e.hasAttribute(t.attributes.noHeight)&&a(e.getAttribute(t.attributes.noHeight)||\"\"),ignoreHiddenCheck:!!e.hasAttribute(t.attributes.ignoreHiddenCheck)&&a(e.getAttribute(t.attributes.ignoreHiddenCheck)||\"\")},this.offsetTop=l(this.el)}var t=e.prototype;return t.updateTopOffset=function(){this.offsetTop=l(this.el)},t.canLazyLoad=function(){return!(!this.options.lazyLoad||this.loaded)&&this.offsetTop-(u()+window.innerHeight)<=this.options.lazyLoadThreshold},t.chooseImage=function(){try{var e=this;if(e.isLoading)return Promise.resolve();if(!e.options.ignoreHiddenCheck&&e.isHidden())return Promise.resolve();e.isLoading=!0;var t=d(e.el.getAttribute(e.config.attributes.sources)||\"\");\"img\"===e.el.tagName.toLowerCase()&&parseInt(getComputedStyle(e.el).width||\"0\",10)<=1&&(e.el.style.width=\"100%\");var n=f(e.el,e.options.noHeight);e.options.matchDPR&&(n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);var i=t.map((function(e){return Object.assign(e,{score:(t=n.width,i=n.height,r=e.width,o=e.height,s=1,r>=t?s*=t/r:s-=Math.abs(t-r),i&&(o>=i?s*=i/o:s-=Math.abs(i-o)),s)});var t,i,r,o,s}));i.sort((function(e,t){return e.score-t.score}));var r=i[i.length-1];if((a=[e.el.getAttribute(\"src\")||\"\",r.url].map((function(e){var t=document.createElement(\"a\");return t.href=e.toLowerCase(),t.host+t.pathname})))[0]===a[1])return Promise.resolve();var o=function(t,n){try{var i=Promise.resolve((o=r.url,new Promise((function(e,t){var n=new Image;n.onload=function(){e(n.src)},n.onerror=function(){t(n.src)},n.src=o})))).then((function(t){\"img\"===e.el.tagName.toLowerCase()?e.el.setAttribute(\"src\",t):e.el.style.backgroundImage=\"url('\"+t+\"')\",e.loaded=!0,e.isLoading=!1,e.currentSize={width:r.width,height:r.height},e.el.classList.remove(e.config.classes.loading),e.el.classList.add(e.config.classes.loaded),s.emit(\"image-loaded\",e.el)}))}catch(e){return n()}var o;return i&&i.then?i.then(void 0,n):i}(0,(function(){console.error(\"error loading image\",r.url)}));return Promise.resolve(o&&o.then?o.then((function(){})):void 0)}catch(e){return Promise.reject(e)}var a},t.isHidden=function(){return null===this.el.offsetParent},e}();e.exports=function(){function e(e){var t=this;this.resizeHandler=function(){for(var e=0;e<t.elements.loaded.length;e++){var n=t.elements.loaded[e],i=f(n.el,n.options.noHeight);(i.width>n.currentSize.width||!n.options.noHeight&&i.height>n.currentSize.height)&&(t.debugger.debug(\"swapping image\"),n.chooseImage())}for(var r=0;r<t.elements.queue.length;r++)t.elements.queue[r].updateTopOffset();t.processElementQueue()},this.scrollHandler=function(){t.processElementQueue()},this.eventsRunning={},this.elements={queue:[],loaded:[]},this.config={events:{resize:\"ImageBuddyResize\",scroll:\"ImageBuddyScroll\"},attributes:{sources:\"data-ib-sources\",lazyLoad:\"data-ib-lazyload\",lazyLoadThreshold:\"data-ib-lazyload-threshold\",matchDPR:\"data-ib-match-dpr\",noHeight:\"data-ib-no-height\",ignoreHiddenCheck:\"data-ib-ignore-hidden-check\"},classes:{base:\"ib__image\",loading:\"ib__image--loading\",loaded:\"ib__image--loaded\"}},this.opts=i({debug:!1,matchDPR:!0,lazyLoad:!0,lazyLoadThreshold:100},e),this.debugger=new r(this.opts.debug),this.setupEventListeners(),this.update()}var t=e.prototype;return t.processElementQueue=function(){var e=0;if(!this.elements.queue.length)return e;for(var t=0;t<this.elements.queue.length;t++){var n=this.elements.queue[t];n.options.lazyLoad&&!1===n.canLazyLoad()||(n.chooseImage(),this.elements.queue.splice(t,1),this.elements.loaded.push(n),t--,e++)}return e},t.update=function(e){void 0===e&&(e={});var t=performance.now(),n=e.parentEl||document.documentElement,i=this.getElements(n),r=e.updateOffsetTop||!1;if(this.elements.queue=this.elements.queue.concat(i),this.debugger.debugInfo(this.elements.queue),r)for(var o=0;o<this.elements.queue.length;o++)this.elements.queue[o].updateTopOffset();var a=this.processElementQueue(),u=performance.now();this.debugger.debug(\"ImageBuddy: update complete\",a+\" elements\",Math.round(u-t)+\"ms\"),s.emit(\"update\")},t.setupEventListeners=function(){this.throttleEventListener(\"resize\",this.resizeHandler,{passive:!0}),this.throttleEventListener(\"scroll\",this.scrollHandler,{passive:!0})},t.getElements=function(e){for(var t=[],n=e.querySelectorAll(\"[\"+this.config.attributes.sources+\"]\"),i=0;i<n.length;i++){var r=n[i];c(r)||h(r)||t.push(new p(r,this.config,this.opts))}return t},t.throttleEventListener=function(e,t,n){var i=this,r=this.passiveEventListenerSupported(),o=Object.assign(n,{passive:void 0===n.passive||n.passive,capture:void 0!==n.capture&&n.capture});this.eventsRunning||(this.eventsRunning={}),Object.prototype.hasOwnProperty.call(this.eventsRunning,e)||(this.eventsRunning[e]=!1),window.addEventListener(e,(function(){i.eventsRunning[e]||(i.eventsRunning[e]=!0,requestAnimationFrame((function(){window.dispatchEvent(new CustomEvent(e+\"-throttled\")),i.eventsRunning[e]=!1})))}),r?o:o.capture),\"function\"==typeof t&&window.addEventListener(e+\"-throttled\",t,r?o:o.capture)},t.passiveEventListenerSupported=function(){var e=!1;try{var t=Object.defineProperty({},\"passive\",{get:function(){return e=!0,!0}});window.addEventListener(\"test\",(function(){}),t)}catch(e){}return e},e.on=function(e,t){s.on(e,t)},e}()},function(e,t,n){\"use strict\";n.r(t);var i=n(0),r=n.n(i);window.ImageBuddy=r.a}]);"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourceRoot":""}