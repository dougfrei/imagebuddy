{"version":3,"file":"imagebuddy.browser.min.js","sources":["webpack:///imagebuddy.browser.min.js"],"sourcesContent":["/**\n * imagebuddy\n *\n * @version v1.1.0\n * @link https://github.com/dougfrei/imagebuddy\n * @license ISC\n *\n */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=1)}([function(e,t){function n(e){return(n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function r(e){return(r=\"function\"==typeof Symbol&&\"symbol\"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":n(e)})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];i(this,e),this.enabled=t}return a(e,[{key:\"debug\",value:function(){var e;this.enabled&&(e=console).log.apply(e,arguments)}},{key:\"debugInfo\",value:function(){var e;this.enabled&&(e=console).info.apply(e,arguments)}},{key:\"debugTable\",value:function(){var e;this.enabled&&(e=console).table.apply(e,arguments)}}]),e}();\"undefined\"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol(\"Symbol.iterator\"))),\"undefined\"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol(\"Symbol.asyncIterator\")));var l={},c=function(){function e(){i(this,e)}return a(e,null,[{key:\"on\",value:function(e,t){\"object\"!==r(l[e])&&(l[e]=[]),l[e].push(t)}},{key:\"emit\",value:function(e){for(var t=arguments,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=t[o];var a=i;setTimeout((function(){if(\"object\"===r(l[e]))for(var t=l[e].slice(),n=0;n<t.length;n++)t[n].apply(null,a)}),0)}}]),e}();function d(e){var t=e.trim().toLowerCase();return\"true\"===t||\"false\"!==t&&parseInt(t,10)>0}function h(){return void 0!==window.pageYOffset?window.pageYOffset:(document.scrollingElement||document.documentElement).scrollTop}function f(e){return e.getBoundingClientRect().top+h()}function p(e){return e.trim()?e.split(\",\").map((function(e){var t,n=function(e){if(Array.isArray(e))return e}(t=e.trim().split(\" \"))||function(e,t){if(\"undefined\"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),3!==n.length);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t)||function(e,t){if(e){if(\"string\"==typeof e)return s(e,3);var n=Object.prototype.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(n):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,3):void 0}}(t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}(),r=n[2];return{url:n[0],width:parseInt(n[1],10),height:parseInt(r,10)}})).sort((function(e,t){return e.width>=e.height?e.width>t.width?1:-1:e.height>t.height?1:-1})):[]}function g(e){return!!e&&!e.hasAttribute(\"data-ib-no-cache\")&&!!e.getAttribute(\"data-ib-cache-id\")}function y(e){return e.hasAttribute(\"data-ib-ignore\")}function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={width:\"block\"===(e.style.display?e.style.display:window.getComputedStyle(e).display)?e.clientWidth:0,height:e.clientHeight?e.clientHeight:0};return!n.width&&e.parentElement&&(n.width=function e(t){return\"block\"!==(t.style.display?t.style.display:window.getComputedStyle(t).display)&&t.parentElement?e(t.parentElement):t.clientWidth}(e.parentElement)),t&&(n.height=0),n}var b=function(){function e(t,n,r){i(this,e),t.classList.add(n.classes.base),t.setAttribute(\"data-ib-cache-id\",Math.random().toString(36).substring(7)),this.el=t,this.config=n,this.elType=t.tagName.toLowerCase(),this.sizes=p(t.getAttribute(n.attributes.sources)||\"\"),this.currentSize={width:0,height:0},this.loaded=!1,this.isLoading=!1,this.options={lazyLoad:t.hasAttribute(n.attributes.lazyLoad)?d(t.getAttribute(n.attributes.lazyLoad)||\"\"):r.lazyLoad,lazyLoadThreshold:t.hasAttribute(n.attributes.lazyLoadThreshold)?parseInt(t.getAttribute(n.attributes.lazyLoadThreshold)||\"0\",10):r.lazyLoadThreshold,matchDPR:t.hasAttribute(n.attributes.matchDPR)?d(t.getAttribute(n.attributes.matchDPR)||\"\"):r.matchDPR,noHeight:!!t.hasAttribute(n.attributes.noHeight)&&d(t.getAttribute(n.attributes.noHeight)||\"\"),ignoreHiddenCheck:!!t.hasAttribute(n.attributes.ignoreHiddenCheck)&&d(t.getAttribute(n.attributes.ignoreHiddenCheck)||\"\")},this.offsetTop=f(this.el)}return a(e,[{key:\"updateTopOffset\",value:function(){this.offsetTop=f(this.el)}},{key:\"canLazyLoad\",value:function(){return!(!this.options.lazyLoad||this.loaded)&&this.offsetTop-(h()+window.innerHeight)<=this.options.lazyLoadThreshold}},{key:\"chooseImage\",value:function(){try{var e=this;if(e.isLoading)return Promise.resolve();if(!e.options.ignoreHiddenCheck&&e.isHidden())return Promise.resolve();e.isLoading=!0;var t=p(e.el.getAttribute(e.config.attributes.sources)||\"\");\"img\"===e.el.tagName.toLowerCase()&&parseInt(getComputedStyle(e.el).width||\"0\",10)<=1&&(e.el.style.width=\"100%\");var n=m(e.el,e.options.noHeight);e.options.matchDPR&&(n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);var r=t.map((function(e){return Object.assign(e,{score:(t=n.width,r=n.height,i=e.width,o=e.height,a=1,i>=t?a*=t/i:a-=Math.abs(t-i),r&&(o>=r?a*=r/o:a-=Math.abs(r-o)),a)});var t,r,i,o,a}));r.sort((function(e,t){return e.score-t.score}));var i=r[r.length-1];if((a=[e.el.getAttribute(\"src\")||\"\",i.url].map((function(e){var t=document.createElement(\"a\");return t.href=e.toLowerCase(),t.host+t.pathname})))[0]===a[1])return Promise.resolve();var o=function(t,n){try{var r=Promise.resolve((o=i.url,new Promise((function(e,t){var n=new Image;n.onload=function(){e(n.src)},n.onerror=function(){t(n.src)},n.src=o})))).then((function(t){\"img\"===e.el.tagName.toLowerCase()?e.el.setAttribute(\"src\",t):e.el.style.backgroundImage=\"url('\".concat(t,\"')\"),e.loaded=!0,e.isLoading=!1,e.currentSize={width:i.width,height:i.height},e.el.classList.remove(e.config.classes.loading),e.el.classList.add(e.config.classes.loaded),c.emit(\"image-loaded\",e.el)}))}catch(e){return n()}var o;return r&&r.then?r.then(void 0,n):r}(0,(function(){console.error(\"error loading image\",i.url)}));return Promise.resolve(o&&o.then?o.then((function(){})):void 0)}catch(e){return Promise.reject(e)}var a}},{key:\"isHidden\",value:function(){return null===this.el.offsetParent}}]),e}();e.exports=function(){function e(t){var n=this;i(this,e),this.resizeHandler=function(){for(var e=0;e<n.elements.loaded.length;e++){var t=n.elements.loaded[e],r=m(t.el,t.options.noHeight);(r.width>t.currentSize.width||!t.options.noHeight&&r.height>t.currentSize.height)&&(n.debugger.debug(\"swapping image\"),t.chooseImage())}for(var i=0;i<n.elements.queue.length;i++)n.elements.queue[i].updateTopOffset();n.processElementQueue()},this.scrollHandler=function(){n.processElementQueue()},this.eventsRunning={},this.elements={queue:[],loaded:[]},this.config={events:{resize:\"ImageBuddyResize\",scroll:\"ImageBuddyScroll\"},attributes:{sources:\"data-ib-sources\",lazyLoad:\"data-ib-lazyload\",lazyLoadThreshold:\"data-ib-lazyload-threshold\",matchDPR:\"data-ib-match-dpr\",noHeight:\"data-ib-no-height\",ignoreHiddenCheck:\"data-ib-ignore-hidden-check\"},classes:{base:\"ib__image\",loading:\"ib__image--loading\",loaded:\"ib__image--loaded\"}},this.opts=Object.assign({debug:!1,matchDPR:!0,lazyLoad:!0,lazyLoadThreshold:100},t),this.debugger=new u(this.opts.debug),this.setupEventListeners(),this.update()}return a(e,[{key:\"processElementQueue\",value:function(){var e=0;if(!this.elements.queue.length)return e;for(var t=0;t<this.elements.queue.length;t++){var n=this.elements.queue[t];n.options.lazyLoad&&!1===n.canLazyLoad()||(n.chooseImage(),this.elements.queue.splice(t,1),this.elements.loaded.push(n),t--,e++)}return e}},{key:\"update\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=performance.now(),n=e.parentEl||document.documentElement,r=this.getElements(n),i=e.updateOffsetTop||!1;if(this.elements.queue=this.elements.queue.concat(r),this.debugger.debugInfo(this.elements.queue),i)for(var o=0;o<this.elements.queue.length;o++)this.elements.queue[o].updateTopOffset();var a=this.processElementQueue(),s=performance.now();this.debugger.debug(\"ImageBuddy: update complete\",\"\".concat(a,\" elements\"),\"\".concat(Math.round(s-t),\"ms\")),c.emit(\"update\")}},{key:\"setupEventListeners\",value:function(){this.throttleEventListener(\"resize\",this.resizeHandler,{passive:!0}),this.throttleEventListener(\"scroll\",this.scrollHandler,{passive:!0})}},{key:\"getElements\",value:function(e){for(var t=[],n=e.querySelectorAll(\"[\".concat(this.config.attributes.sources,\"]\")),r=0;r<n.length;r++){var i=n[r];g(i)||y(i)||t.push(new b(i,this.config,this.opts))}return t}},{key:\"throttleEventListener\",value:function(e,t,n){var r=this,i=this.passiveEventListenerSupported(),o=Object.assign(n,{passive:void 0===n.passive||n.passive,capture:void 0!==n.capture&&n.capture});this.eventsRunning||(this.eventsRunning={}),Object.prototype.hasOwnProperty.call(this.eventsRunning,e)||(this.eventsRunning[e]=!1),window.addEventListener(e,(function(){r.eventsRunning[e]||(r.eventsRunning[e]=!0,requestAnimationFrame((function(){window.dispatchEvent(new CustomEvent(\"\".concat(e,\"-throttled\"))),r.eventsRunning[e]=!1})))}),i?o:o.capture),\"function\"==typeof t&&window.addEventListener(\"\".concat(e,\"-throttled\"),t,i?o:o.capture)}},{key:\"passiveEventListenerSupported\",value:function(){var e=!1;try{var t=Object.defineProperty({},\"passive\",{get:function(){return e=!0,!0}});window.addEventListener(\"test\",(function(){}),t)}catch(e){}return e}}],[{key:\"on\",value:function(e,t){c.on(e,t)}}]),e}()},function(e,t,n){\"use strict\";n.r(t);var r=n(0),i=n.n(r);window.ImageBuddy=i.a}]);"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourceRoot":""}