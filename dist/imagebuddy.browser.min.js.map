{"version":3,"file":"imagebuddy.browser.min.js","sources":["webpack:///imagebuddy.browser.min.js"],"sourcesContent":["/**\n * imagebuddy\n *\n * @version v1.1.0\n * @link https://github.com/dougfrei/imagebuddy\n * @license ISC\n *\n */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=1)}([function(e,t){function n(e){return(n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function i(e){return(i=\"function\"==typeof Symbol&&\"symbol\"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":n(e)})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o(this,e),this.enabled=t}return a(e,[{key:\"debug\",value:function(){var e;this.enabled&&(e=console).log.apply(e,arguments)}},{key:\"debugInfo\",value:function(){var e;this.enabled&&(e=console).info.apply(e,arguments)}},{key:\"debugTable\",value:function(){var e;this.enabled&&(e=console).table.apply(e,arguments)}}]),e}(),u={},l=function(){function e(){o(this,e)}return a(e,null,[{key:\"on\",value:function(e,t){\"object\"!==i(u[e])&&(u[e]=[]),u[e].push(t)}},{key:\"emit\",value:function(e){for(var t=arguments,n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=t[r];var a=o;setTimeout(function(){if(\"object\"===i(u[e]))for(var t=u[e].slice(),n=0;n<t.length;n++)t[n].apply(null,a)},0)}}]),e}();function c(e){return\"true\"===e.toLowerCase()||Boolean(parseInt(e,10))}function h(){return void 0!==window.pageYOffset?window.pageYOffset:(document.scrollingElement||document.documentElement).scrollTop}function d(e){return e.getBoundingClientRect().top+h()}function f(e){return e.trim()?e.split(\",\").map(function(e){var t,n=function(e){if(Array.isArray(e))return e}(t=e.trim().split(\" \"))||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),3!==n.length);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}(),i=n[2];return{url:n[0],width:parseInt(n[1],10),height:parseInt(i,10)}}).sort(function(e,t){return e.width>=e.height?e.width>t.width?1:-1:e.height>t.height?1:-1}):[]}function p(e){return!!e&&!e.hasAttribute(\"data-ib-no-cache\")&&!!e.getAttribute(\"data-ib-cache-id\")}function g(e){return e.hasAttribute(\"data-ib-ignore\")}function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={width:\"block\"===(e.style.display?e.style.display:window.getComputedStyle(e).display)?e.clientWidth:0,height:e.clientHeight?e.clientHeight:0};return!n.width&&e.parentElement&&(n.width=function e(t){return\"block\"!==(t.style.display?t.style.display:window.getComputedStyle(t).display)&&t.parentElement?e(t.parentElement):t.clientWidth}(e.parentElement)),t&&(n.height=0),n}var v=function(){function e(t,n,i){o(this,e),t.classList.add(n.classes.base),t.setAttribute(\"data-ib-cache-id\",Math.random().toString(36).substring(7)),this.el=t,this.config=n,this.elType=t.tagName.toLowerCase(),this.sizes=f(t.getAttribute(n.attributes.sources)||\"\"),this.currentSize={width:0,height:0},this.loaded=!1,this.isLoading=!1,this.options={lazyLoad:t.hasAttribute(n.attributes.lazyLoad)?c(t.getAttribute(n.attributes.lazyLoad)||\"\"):i.lazyLoad,lazyLoadThreshold:t.hasAttribute(n.attributes.lazyLoadThreshold)?parseInt(t.getAttribute(n.attributes.lazyLoadThreshold)||\"0\",10):i.lazyLoadThreshold,matchDPR:t.hasAttribute(n.attributes.matchDPR)?c(t.getAttribute(n.attributes.matchDPR)||\"\"):i.matchDPR,noHeight:!!t.hasAttribute(n.attributes.noHeight)&&t.hasAttribute(n.attributes.noHeight)},this.offsetTop=d(this.el)}return a(e,[{key:\"updateTopOffset\",value:function(){this.offsetTop=d(this.el)}},{key:\"canLazyLoad\",value:function(){return!(!this.options.lazyLoad||this.loaded)&&this.offsetTop-(h()+window.innerHeight)<=this.options.lazyLoadThreshold}},{key:\"chooseImage\",value:function(){try{var e=this;if(e.isLoading)return Promise.resolve();e.isLoading=!0;var t=f(e.el.getAttribute(e.config.attributes.sources)||\"\");\"img\"===e.el.tagName.toLowerCase()&&parseInt(getComputedStyle(e.el).width||\"0\",10)<=1&&(e.el.style.width=\"100%\");var n=m(e.el,e.options.noHeight);e.options.matchDPR&&(n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);var i=t.map(function(e){return Object.assign(e,{score:(t=n.width,i=n.height,o=e.width,r=e.height,a=1,o>=t?a*=t/o:a-=Math.abs(t-o),i&&(r>=i?a*=i/r:a-=Math.abs(i-r)),a)});var t,i,o,r,a});i.sort(function(e,t){return e.score-t.score});var o=i[i.length-1];if((a=[e.el.getAttribute(\"src\")||\"\",o.url].map(function(e){var t=document.createElement(\"a\");return t.href=e.toLowerCase(),t.host+t.pathname}))[0]===a[1])return Promise.resolve();var r=function(t,n){try{var i=Promise.resolve((r=o.url,new Promise(function(e,t){var n=new Image;n.onload=function(){e(n.src)},n.onerror=function(){t(n.src)},n.src=r}))).then(function(t){\"img\"===e.el.tagName.toLowerCase()?e.el.setAttribute(\"src\",t):e.el.style.backgroundImage=\"url('\".concat(t,\"')\"),e.loaded=!0,e.isLoading=!1,e.currentSize={width:o.width,height:o.height},e.el.classList.remove(e.config.classes.loading),e.el.classList.add(e.config.classes.loaded),l.emit(\"image-loaded\",e.el)})}catch(e){return n()}var r;return i&&i.then?i.then(void 0,n):i}(0,function(){console.error(\"error loading image\",o.url)});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}var a}}]),e}();e.exports=function(){function e(t){var n=this;o(this,e),this.resizeHandler=function(){for(var e=0;e<n.elements.loaded.length;e++){var t=n.elements.loaded[e],i=m(t.el,t.options.noHeight);(i.width>t.currentSize.width||!t.options.noHeight&&i.height>t.currentSize.height)&&(n.debugger.debug(\"swapping image\"),t.chooseImage())}for(var o=0;o<n.elements.queue.length;o++)n.elements.queue[o].updateTopOffset();n.processElementQueue()},this.scrollHandler=function(){n.processElementQueue()},this.eventsRunning={},this.elements={queue:[],loaded:[]},this.config={events:{resize:\"ImageBuddyResize\",scroll:\"ImageBuddyScroll\"},attributes:{sources:\"data-ib-sources\",lazyLoad:\"data-ib-lazyload\",lazyLoadThreshold:\"data-ib-lazyload-threshold\",matchDPR:\"data-ib-match-dpr\",noHeight:\"data-ib-no-height\"},classes:{base:\"ib__image\",loading:\"ib__image--loading\",loaded:\"ib__image--loaded\"}},this.opts=Object.assign({debug:!1,matchDPR:!0,lazyLoad:!0,lazyLoadThreshold:100},t),this.debugger=new s(this.opts.debug),this.setupEventListeners(),this.update()}return a(e,[{key:\"processElementQueue\",value:function(){var e=0;if(!this.elements.queue.length)return e;for(var t=0;t<this.elements.queue.length;t++){var n=this.elements.queue[t];n.options.lazyLoad&&!1===n.canLazyLoad()||(n.chooseImage(),this.elements.queue.splice(t,1),this.elements.loaded.push(n),t--,e++)}return e}},{key:\"update\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=performance.now(),n=e.parentEl||document.documentElement,i=this.getElements(n),o=e.updateOffsetTop||!1;if(this.elements.queue=this.elements.queue.concat(i),this.debugger.debugInfo(this.elements.queue),o)for(var r=0;r<this.elements.queue.length;r++)this.elements.queue[r].updateTopOffset();var a=this.processElementQueue(),s=performance.now();this.debugger.debug(\"ImageBuddy: update complete\",\"\".concat(a,\" elements\"),\"\".concat(Math.round(s-t),\"ms\")),l.emit(\"update\")}},{key:\"setupEventListeners\",value:function(){this.throttleEventListener(\"resize\",this.resizeHandler,{passive:!0}),this.throttleEventListener(\"scroll\",this.scrollHandler,{passive:!0})}},{key:\"getElements\",value:function(e){for(var t=[],n=e.querySelectorAll(\"[\".concat(this.config.attributes.sources,\"]\")),i=0;i<n.length;i++){var o=n[i];p(o)||g(o)||t.push(new v(o,this.config,this.opts))}return t}},{key:\"throttleEventListener\",value:function(e,t,n){var i=this,o=this.passiveEventListenerSupported(),r=Object.assign(n,{passive:void 0===n.passive||n.passive,capture:void 0!==n.capture&&n.capture});this.eventsRunning||(this.eventsRunning={}),Object.prototype.hasOwnProperty.call(this.eventsRunning,e)||(this.eventsRunning[e]=!1),window.addEventListener(e,function(){i.eventsRunning[e]||(i.eventsRunning[e]=!0,requestAnimationFrame(function(){window.dispatchEvent(new CustomEvent(\"\".concat(e,\"-throttled\"))),i.eventsRunning[e]=!1}))},o?r:r.capture),\"function\"==typeof t&&window.addEventListener(\"\".concat(e,\"-throttled\"),t,o?r:r.capture)}},{key:\"passiveEventListenerSupported\",value:function(){var e=!1;try{var t=Object.defineProperty({},\"passive\",{get:function(){return e=!0,!0}});window.addEventListener(\"test\",function(){},t)}catch(e){}return e}}],[{key:\"on\",value:function(e,t){l.on(e,t)}}]),e}()},function(e,t,n){\"use strict\";n.r(t);var i=n(0),o=n.n(i);window.ImageBuddy=o.a}]);"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourceRoot":""}