/**
 * ImageTools v0.3.4 | ISC
 */
!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(i(1));window.ImageTools=n.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,o=!1,s=void 0;try{for(var a,r=t[Symbol.iterator]();!(n=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){o=!0,s=t}finally{try{!n&&r.return&&r.return()}finally{if(o)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(2);(0,a.polyfillObjectAssign)(),(0,a.polyfillCustomEvent)();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.eventsRunning={},this.elementCache=[],this.elements={queue:[],loaded:[]},this.events=[],this.currentCacheId=0,this.config={events:{resize:"imageToolsResize",scroll:"imageToolsScroll"},attributes:{sources:"data-it-sources",lazyLoad:"data-it-lazyload",lazyLoadThreshold:"data-it-lazyload-threshold",matchDPR:"data-it-match-dpr",noHeight:"data-it-no-height"},classes:{base:"it__image",loading:"it__image--loading",loaded:"it__image--loaded"}},this.opts=Object.assign({debug:!1,matchDPR:!0,lazyLoad:!0,lazyLoadThreshold:100},e),this.passiveSupported=!1;try{var i=Object.defineProperty({},"passive",{get:function(){this.passiveSupported=!0}});window.addEventListener("test",null,i)}catch(t){}this.setupEventListeners(),this.update()}return s(t,[{key:"processElementQueue",value:function(){if(this.elements.queue.length)for(var t=0;t<this.elements.queue.length;t++){var e=this.elements.queue[t];e.options.lazyLoad&&!1===this.canLazyLoad(e)||(this.chooseImage(e),this.elements.queue.splice(t,1),this.elements.loaded.push(e),t--)}}},{key:"update",value:function(){var t=this.getElements();this.elements.queue=this.elements.queue.concat(t),this.debugInfo(this.elements.queue),this.processElementQueue(),window.dispatchEvent(new CustomEvent("it-update",{}))}},{key:"canLazyLoad",value:function(t){return!(!t.options.lazyLoad||t.loaded)&&t.offsetTop-(window.pageYOffset+window.innerHeight)<=t.options.lazyLoadThreshold}},{key:"throttleEventListener",value:function(t,e,i){var n=this;i.passive=void 0===i.passive||i.passive,i.capture=void 0!==i.capture&&i.capture,this.eventsRunning.hasOwnProperty(t)||(this.eventsRunning[t]=!1),window.addEventListener(t,function(){n.eventsRunning[t]||(n.eventsRunning[t]=!0,requestAnimationFrame(function(){window.dispatchEvent(new CustomEvent(t+"-throttled")),n.eventsRunning[t]=!1}))},this.passiveSupported?i:i.capture),"function"==typeof e&&window.addEventListener(t+"-throttled",e,this.passiveSupported?i:i.capture)}},{key:"setupEventListeners",value:function(){this.throttleEventListener("resize",this.resizeHandler.bind(this),{passive:!0}),this.throttleEventListener("scroll",this.scrollHandler.bind(this),{passive:!0})}},{key:"debug",value:function(){if(this.opts.debug){var t;(t=console).log.apply(t,arguments)}}},{key:"debugInfo",value:function(){if(this.opts.debug){var t;(t=console).info.apply(t,arguments)}}},{key:"debugTable",value:function(){if(this.opts.debug){var t;(t=console).table.apply(t,arguments)}}},{key:"calculateElementTopOffset",value:function(t){return t.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop)}},{key:"getElements",value:function(){for(var t=[],e=document.querySelectorAll("["+this.config.attributes.sources+"]"),i=0;i<e.length;i++){var n=e[i];n.getAttribute("data-it-cache-id")&&!n.hasAttribute("data-it-no-cache")||(n.hasAttribute("data-it-ignore")||(n.setAttribute("data-it-cache-id",this.nextCacheId),n.classList.add(this.config.classes.base),t.push({el:n,elType:n.tagName.toLowerCase(),cacheId:n.getAttribute("data-it-cache-id"),offsetTop:this.calculateElementTopOffset(n),sizes:this.getSizes(n.getAttribute(this.config.attributes.sources)),currentSize:!1,loaded:!1,options:{lazyLoad:n.getAttribute(this.config.attributes.lazyLoad)?this.parseBooleanString(n.getAttribute(this.config.attributes.lazyLoad)):this.opts.lazyLoad,lazyLoadThreshold:n.getAttribute(this.config.attributes.lazyLoadThreshold)?n.getAttribute(this.config.attributes.lazyLoadThreshold):this.opts.lazyLoadThreshold,matchDPR:n.getAttribute(this.config.attributes.matchDPR)?this.parseBooleanString(n.getAttribute(this.config.attributes.matchDPR)):this.opts.matchDPR,noHeight:!!n.getAttribute(this.config.attributes.noHeight)&&n.getAttribute(this.config.attributes.noHeight)}})))}return t}},{key:"parseBooleanString",value:function(t){return"string"==typeof t&&"true"===t.toLowerCase()||Boolean(parseInt(t))}},{key:"getContainerDimensions",value:function(t,e){var i={width:"block"==(t.style.display?t.style.display:window.getComputedStyle(t).display)?t.clientWidth:0,height:t.clientHeight?t.clientHeight:0};return i.width||(i.width=this.getElementWidth(t.parentElement)),e&&(i.height=0),i}},{key:"getElementWidth",value:function(t){return"block"!=(t.style.display?t.style.display:window.getComputedStyle(t).display)&&t.parentElement?this.getElementWidth(t.parentElement):t.clientWidth}},{key:"getSizes",value:function(t){return t.split(",").map(function(t){var e=t.trim().split(" "),i=o(e,3),n=i[0],s=i[1],a=i[2];return{url:n,width:parseInt(s),height:parseInt(a)}}).sort(function(t,e){return t.width>=t.height?t.width>e.width?1:-1:t.height>e.height?1:-1})}},{key:"calculateUsabilityScore",value:function(t,e,i,n){this.debug("container: "+t+"x"+e,"image: "+i+"x"+n);var o=1;return i>=t?o*=t/i:o-=Math.abs(t-i),e&&(n>=e?o*=e/n:o-=Math.abs(e-n)),o}},{key:"chooseImage",value:function(t){var e=this;if(!t.isLoading){t.isLoading=!0;var i=this.getSizes(t.el.getAttribute(this.config.attributes.sources));"img"==t.el.tagName.toLowerCase()&&parseInt(getComputedStyle(t.el).width)<=1&&(t.el.style.width="100%");var n=this.getContainerDimensions(t.el,t.options.noHeight);t.options.matchDPR&&(n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);var o=i.map(function(t){return t.score=e.calculateUsabilityScore(n.width,n.height,t.width,t.height),t});o.sort(function(t,e){return t.score-e.score}),this.debugTable(o);var s=o[o.length-1];this.debug(s),this.loadImage(t.el,s.url,function(){t.loaded=!0,t.isLoading=!1,t.currentSize={width:s.width,height:s.height},t.el.classList.remove(e.config.classes.loading),t.el.classList.add(e.config.classes.loaded),e.debug("dispatching load event: "+t.el.getAttribute("src")),window.dispatchEvent(new CustomEvent("it-imageLoad",{detail:{el:t.el}}))})}}},{key:"loadImage",value:function(t,e,i){var n=new Image;n.onload=function(e){"img"===t.tagName.toLowerCase()?t.setAttribute("src",this.src):t.style.backgroundImage="url('"+this.src+"')",i&&"function"==typeof i&&i()},n.src=e}},{key:"resizeHandler",value:function(){for(var t=0;t<this.elements.loaded.length;t++){var e=this.elements.loaded[t],i=this.getContainerDimensions(e.el);(i.width>e.currentSize.width||!e.noHeight&&i.height>e.currentSize.height)&&(this.debug("swapping image"),this.chooseImage(e))}this.processElementQueue()}},{key:"scrollHandler",value:function(){this.processElementQueue()}},{key:"on",value:function(t,e){"object"!==n(this.events[t])&&(this.events[t]=[]),this.events[t].push(e)}},{key:"emit",value:function(t){var e,i,o,s=[].slice.call(arguments,1);if("object"===n(this.events[t]))for(o=(i=this.events[t].slice()).length,e=0;e<o;e++)i[e].apply(this,s)}},{key:"nextCacheId",get:function(){return this.currentCacheId=this.currentCacheId+1,this.currentCacheId}}]),t}();e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.polyfillObjectAssign=function(){"function"!=typeof Object.assign&&(Object.assign=function(t,e){if(null===t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!==o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i})},e.polyfillCustomEvent=function(){if("function"!=typeof window.CustomEvent){var t=function(t,e){var i=e||{bubbles:!1,cancelable:!1,detail:void 0},n=document.createEvent("CustomEvent");return n.initCustomEvent(t,i.bubbles,i.cancelable,i.detail),n};t.prototype=window.Event.prototype,window.CustomEvent=t}}}]);
//# sourceMappingURL=imageTools.bundle.min.js.map