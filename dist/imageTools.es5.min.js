"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ImageTools=function(){function e(t){_classCallCheck(this,e),this.eventsRunning={},this.elementCache=[],this.config={events:{resize:"imageToolsResize",scroll:"imageToolsScroll"},attributes:{sources:"data-it-sources",lazyLoad:"data-it-lazyload"}},this.opts=Object.assign({debug:!1,matchDPR:!0,lazyLoadDefault:!1,lazyLoadThreshold:100},t),this.setupEventListeners(),this.getElements(),this.processElementCache()}return _createClass(e,[{key:"processElementCache",value:function(){var e=this;this.elementCache.forEach(function(t){t.loaded||t.lazyLoad&&!e.canLazyLoad(t)||e.chooseImage(t)})}},{key:"canLazyLoad",value:function(e){return!(!e.lazyLoad||e.loaded)&&e.el.offsetTop-(window.scrollY+window.innerHeight)<=this.opts.lazyLoadThreshold}},{key:"throttleEventListener",value:function(e,t){var n=this;this.eventsRunning.hasOwnProperty(e)||(this.eventsRunning[e]=!1),window.addEventListener(e,function(){n.eventsRunning[e]||(n.eventsRunning[e]=!0,requestAnimationFrame(function(){window.dispatchEvent(new CustomEvent(e+"-throttled")),n.eventsRunning[e]=!1}))}),"function"==typeof t&&window.addEventListener(e+"-throttled",t)}},{key:"setupEventListeners",value:function(){this.throttleEventListener("resize",this.resizeHandler.bind(this)),this.throttleEventListener("scroll",this.scrollHandler.bind(this))}},{key:"debug",value:function(){if(this.opts.debug){var e;(e=console).log.apply(e,arguments)}}},{key:"getElements",value:function(){var e=this;this.elementCache=[],document.querySelectorAll("["+this.config.attributes.sources+"]").forEach(function(t){e.elementCache.push({el:t,elType:t.tagName.toLowerCase(),container:e.getContainerDimensions(t),sizes:e.getSizes(t.getAttribute(e.config.attributes.sources)),lazyLoad:t.getAttribute(e.config.attributes.lazyLoad)?"true"==t.getAttribute(e.config.attributes.lazyLoad):e.opts.lazyLoadDefault,loaded:!1})}),console.info(this.elementCache)}},{key:"getContainerDimensions",value:function(e){var t={width:0,height:0};switch(e.tagName.toLowerCase()){case"div":case"img":t.width=e.clientWidth,t.height=e.clientHeight}return t}},{key:"getSizes",value:function(e){return e.split(";").map(function(e){var t=e.split(","),n=_slicedToArray(t,3),i=n[0],a=n[1],o=n[2];return{url:i,width:parseInt(a),height:parseInt(o)}}).sort(function(e,t){return e.width>=e.height?e.width>t.width?1:-1:e.height>t.height?1:-1})}},{key:"chooseImage",value:function(e){var t=this.getSizes(e.el.getAttribute(this.config.attributes.sources)),n=e.el.tagName.toLowerCase();console.table(t);var i=this.getContainerDimensions(e.el);this.opts.matchDPR&&(i.width*=window.devicePixelRatio,i.height*=window.devicePixelRatio);var a=t.filter(function(e){return e.width>=i.width&&e.height>=i.height}),o=a.length?a[0]:t[t.length-1];switch(n){case"div":e.el.style.backgroundImage="url('"+o.url+"')";break;case"img":e.el.setAttribute("src",o.url)}e.loaded=!0}},{key:"resizeHandler",value:function(){this.debug("resizeHandler")}},{key:"scrollHandler",value:function(){var e=this;this.elementCache.forEach(function(t){t.loaded||t.lazyLoad&&!e.canLazyLoad(t)||(console.info("choosing image",t),e.chooseImage(t))})}}]),e}();
//# sourceMappingURL=imageTools.es5.min.js.map
