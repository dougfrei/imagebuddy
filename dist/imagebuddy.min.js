/**
 * imagebuddy
 *
 * @version v1.0.1
 * @link https://github.com/dougfrei/imagebuddy
 * @license ISC
 */
!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"getUniqueId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.uidCounter||(this.uidCounter=0),"".concat(e).concat(++this.uidCounter)}},{key:"parseBooleanString",value:function(e){return"string"==typeof e&&"true"===e.toLowerCase()||Boolean(parseInt(e))}},{key:"passiveEventListenerSupported",value:function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}},{key:"throttleEventListener",value:function(e,t,n){var i=this,o=this.passiveEventListenerSupported();n.passive=void 0===n.passive||n.passive,n.capture=void 0!==n.capture&&n.capture,this.eventsRunning||(this.eventsRunning={}),this.eventsRunning.hasOwnProperty(e)||(this.eventsRunning[e]=!1),window.addEventListener(e,function(){i.eventsRunning[e]||(i.eventsRunning[e]=!0,requestAnimationFrame(function(){window.dispatchEvent(new CustomEvent("".concat(e,"-throttled"))),i.eventsRunning[e]=!1}))},o?n:n.capture),"function"==typeof t&&window.addEventListener("".concat(e,"-throttled"),t,o?n:n.capture)}}],(n=null)&&i(t.prototype,n),o&&i(t,o),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.enabled=t}var t,n,i;return t=e,(n=[{key:"debug",value:function(){var e;this.enabled&&(e=console).log.apply(e,arguments)}},{key:"debugInfo",value:function(){var e;this.enabled&&(e=console).info.apply(e,arguments)}},{key:"debugTable",value:function(){var e;this.enabled&&(e=console).table.apply(e,arguments)}}])&&a(t.prototype,n),i&&a(t,i),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"on",value:function(e,t){void 0===window.itEvents&&(window.itEvents={}),"object"!==s(window.itEvents[e])&&(window.itEvents[e]=[]),window.itEvents[e].push(t)}},{key:"emit",value:function(e){var t=this,n=arguments;void 0===window.itEvents&&(window.itEvents={}),setTimeout(function(){if("object"===s(window.itEvents[e]))for(var i=window.itEvents[e].slice(),o=i.length,a=[].slice.call(n,1),r=0;r<o;r++)i[r].apply(t,a)},0)}}],(n=null)&&u(t.prototype,n),i&&u(t,i),e}();function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.classList.add(n.classes.base),t.setAttribute("data-ib-cache-id",o.getUniqueId()),this.el=t,this.config=n,this.elType=t.tagName.toLowerCase(),this.cacheId=t.getAttribute("data-ib-cache-id"),this.sizes=this.getSizes(t.getAttribute(n.attributes.sources)),this.currentSize=!1,this.loaded=!1,this.isLoading=!1,this.options={lazyLoad:t.getAttribute(n.attributes.lazyLoad)?o.parseBooleanString(t.getAttribute(n.attributes.lazyLoad)):i.lazyLoad,lazyLoadThreshold:t.getAttribute(n.attributes.lazyLoadThreshold)?t.getAttribute(n.attributes.lazyLoadThreshold):i.lazyLoadThreshold,matchDPR:t.getAttribute(n.attributes.matchDPR)?o.parseBooleanString(t.getAttribute(n.attributes.matchDPR)):i.matchDPR,noHeight:!!t.getAttribute(n.attributes.noHeight)&&t.getAttribute(n.attributes.noHeight)},this.calculateElementTopOffset()}var t,n,i;return t=e,i=[{key:"isCached",value:function(e){return e.getAttribute("data-ib-cache-id")&&!e.hasAttribute("data-ib-no-cache")}},{key:"shouldIgnore",value:function(e){return e.hasAttribute("data-ib-ignore")}}],(n=[{key:"calculateElementTopOffset",value:function(){this.offsetTop=this.el.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop)}},{key:"getSizes",value:function(e){return e.split(",").map(function(e){var t=c(e.trim().split(" "),3),n=t[0],i=t[1],o=t[2];return{url:n,width:parseInt(i),height:parseInt(o)}}).sort(function(e,t){return e.width>=e.height?e.width>t.width?1:-1:e.height>t.height?1:-1})}},{key:"canLazyLoad",value:function(){return!(!this.options.lazyLoad||this.loaded)&&this.offsetTop-(window.pageYOffset+window.innerHeight)<=this.options.lazyLoadThreshold}},{key:"chooseImage",value:function(){var e=this;if(!this.isLoading){this.isLoading=!0;var t=this.getSizes(this.el.getAttribute(this.config.attributes.sources));"img"===this.el.tagName.toLowerCase()&&parseInt(getComputedStyle(this.el).width)<=1&&(this.el.style.width="100%");var n=this.getContainerDimensions();this.options.matchDPR&&(n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);var i=t.map(function(t){return t.score=e.calculateUsabilityScore(n.width,n.height,t.width,t.height),t});i.sort(function(e,t){return e.score-t.score});var o=i[i.length-1];this.loadImage(o.url,function(){e.loaded=!0,e.isLoading=!1,e.currentSize={width:o.width,height:o.height},e.el.classList.remove(e.config.classes.loading),e.el.classList.add(e.config.classes.loaded),l.emit("image-loaded",e.el)})}}},{key:"calculateUsabilityScore",value:function(e,t,n,i){var o=1;return n>=e?o*=e/n:o-=Math.abs(e-n),t&&(i>=t?o*=t/i:o-=Math.abs(t-i)),o}},{key:"getContainerDimensions",value:function(){var e={width:"block"===(this.el.style.display?this.el.style.display:window.getComputedStyle(this.el).display)?this.el.clientWidth:0,height:this.el.clientHeight?this.el.clientHeight:0};return e.width||(e.width=this.getElementWidth(this.el.parentElement)),this.options.noHeight&&(e.height=0),e}},{key:"getElementWidth",value:function(e){return"block"!==(e.style.display?e.style.display:window.getComputedStyle(e).display)&&e.parentElement?this.getElementWidth(e.parentElement):e.clientWidth}},{key:"loadImage",value:function(e,t){var n=new Image,i=this.el;n.onload=function(){"img"===i.tagName.toLowerCase()?i.setAttribute("src",this.src):i.style.backgroundImage="url('".concat(this.src,"')"),t&&"function"==typeof t&&t()},n.src=e}}])&&h(t.prototype,n),i&&h(t,i),e}();function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"resizeHandler",function(){for(var e=0;e<n.elements.loaded.length;e++){var t=n.elements.loaded[e],i=t.getContainerDimensions();(i.width>t.currentSize.width||!t.noHeight&&i.height>t.currentSize.height)&&(n.debugger.debug("swapping image"),t.chooseImage())}for(var o=0;o<n.elements.queue.length;o++)n.elements.queue[o].calculateElementTopOffset();n.processElementQueue()}),g(this,"scrollHandler",function(){n.processElementQueue()}),this.eventsRunning={},this.elementCache=[],this.elements={queue:[],loaded:[]},this.events=[],this.currentCacheId=0,this.config={events:{resize:"ImageBuddyResize",scroll:"ImageBuddyScroll"},attributes:{sources:"data-ib-sources",lazyLoad:"data-ib-lazyload",lazyLoadThreshold:"data-ib-lazyload-threshold",matchDPR:"data-ib-match-dpr",noHeight:"data-ib-no-height"},classes:{base:"ib__image",loading:"ib__image--loading",loaded:"ib__image--loaded"}},this.opts=Object.assign({debug:!1,matchDPR:!0,lazyLoad:!0,lazyLoadThreshold:100},t),this.debugger=new r(this.opts.debug),this.setupEventListeners(),this.update()}var t,n,i;return t=e,i=[{key:"on",value:function(e,t){l.on(e,t)}}],(n=[{key:"processElementQueue",value:function(){var e=0;if(!this.elements.queue.length)return e;for(var t=0;t<this.elements.queue.length;t++){var n=this.elements.queue[t];n.options.lazyLoad&&!1===n.canLazyLoad(n)||(n.chooseImage(),this.elements.queue.splice(t,1),this.elements.loaded.push(n),t--,e++)}return e}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=performance.now(),n=e.parentEl||document,i=this.getElements(n),o=e.updateOffsetTop||!1;if(this.elements.queue=this.elements.queue.concat(i),this.debugger.debugInfo(this.elements.queue),o)for(var a=0;a<this.elements.queue.length;a++)this.elements.queue[a].calculateElementTopOffset();var r=this.processElementQueue(),s=performance.now();this.debugger.debug("ImageBuddy: update complete","".concat(r," elements"),"".concat(Math.round(s-t),"ms")),l.emit("update")}},{key:"setupEventListeners",value:function(){o.throttleEventListener("resize",this.resizeHandler,{passive:!0}),o.throttleEventListener("scroll",this.scrollHandler,{passive:!0})}},{key:"getElements",value:function(e){for(var t=[],n=e.querySelectorAll("[".concat(this.config.attributes.sources,"]")),i=0;i<n.length;i++){var o=n[i];d.isCached(o)||d.shouldIgnore(o)||t.push(new d(o,this.config,this.opts))}return t}}])&&f(t.prototype,n),i&&f(t,i),e}();window.ImageBuddy=p}]);
//# sourceMappingURL=imagebuddy.min.js.map