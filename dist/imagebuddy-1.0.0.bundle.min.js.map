{"version":3,"file":"imagebuddy-1.0.0.bundle.min.js","sources":["webpack:///imagebuddy-1.0.0.bundle.min.js"],"sourcesContent":["!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=5)}([function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e)}return r(e,null,[{key:\"on\",value:function(e,t){void 0===window.itEvents&&(window.itEvents={}),\"object\"!==i(window.itEvents[e])&&(window.itEvents[e]=[]),window.itEvents[e].push(t)}},{key:\"emit\",value:function(e){var t=arguments,n=this;void 0===window.itEvents&&(window.itEvents={}),setTimeout(function(){if(\"object\"===i(window.itEvents[e]))for(var r=window.itEvents[e].slice(),o=r.length,a=[].slice.call(t,1),s=0;s<o;s++)r[s].apply(n,a)},0)}}]),e}();t.default=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e)}return i(e,null,[{key:\"getUniqueId\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\";return this.uidCounter||(this.uidCounter=0),\"\"+e+ ++this.uidCounter}},{key:\"parseBooleanString\",value:function(e){return\"string\"==typeof e&&\"true\"===e.toLowerCase()||Boolean(parseInt(e))}},{key:\"passiveEventListenerSupported\",value:function(){var e=!1;try{var t=Object.defineProperty({},\"passive\",{get:function(){e=!0}});window.addEventListener(\"test\",null,t)}catch(e){}return e}},{key:\"throttleEventListener\",value:function(e,t,n){var i=this,r=this.passiveEventListenerSupported();n.passive=void 0===n.passive||n.passive,n.capture=void 0!==n.capture&&n.capture,this.eventsRunning||(this.eventsRunning={}),this.eventsRunning.hasOwnProperty(e)||(this.eventsRunning[e]=!1),window.addEventListener(e,function(){i.eventsRunning[e]||(i.eventsRunning[e]=!0,requestAnimationFrame(function(){window.dispatchEvent(new CustomEvent(e+\"-throttled\")),i.eventsRunning[e]=!1}))},r?n:n.capture),\"function\"==typeof t&&window.addEventListener(e+\"-throttled\",t,r?n:n.capture)}}]),e}();t.default=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(1)),a=s(n(0));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),t.classList.add(n.classes.base),t.setAttribute(\"data-ib-cache-id\",o.default.getUniqueId()),this.el=t,this.config=n,this.elType=t.tagName.toLowerCase(),this.cacheId=t.getAttribute(\"data-ib-cache-id\"),this.sizes=this.getSizes(t.getAttribute(n.attributes.sources)),this.currentSize=!1,this.loaded=!1,this.isLoading=!1,this.options={lazyLoad:t.getAttribute(n.attributes.lazyLoad)?o.default.parseBooleanString(t.getAttribute(n.attributes.lazyLoad)):i.lazyLoad,lazyLoadThreshold:t.getAttribute(n.attributes.lazyLoadThreshold)?t.getAttribute(n.attributes.lazyLoadThreshold):i.lazyLoadThreshold,matchDPR:t.getAttribute(n.attributes.matchDPR)?o.default.parseBooleanString(t.getAttribute(n.attributes.matchDPR)):i.matchDPR,noHeight:!!t.getAttribute(n.attributes.noHeight)&&t.getAttribute(n.attributes.noHeight)},this.calculateElementTopOffset()}return r(e,[{key:\"calculateElementTopOffset\",value:function(){this.offsetTop=this.el.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop)}},{key:\"getSizes\",value:function(e){return e.split(\",\").map(function(e){var t=e.trim().split(\" \"),n=i(t,3),r=n[0],o=n[1],a=n[2];return{url:r,width:parseInt(o),height:parseInt(a)}}).sort(function(e,t){return e.width>=e.height?e.width>t.width?1:-1:e.height>t.height?1:-1})}},{key:\"canLazyLoad\",value:function(){return!(!this.options.lazyLoad||this.loaded)&&this.offsetTop-(window.pageYOffset+window.innerHeight)<=this.options.lazyLoadThreshold}},{key:\"chooseImage\",value:function(){var e=this;if(!this.isLoading){this.isLoading=!0;var t=this.getSizes(this.el.getAttribute(this.config.attributes.sources));\"img\"==this.el.tagName.toLowerCase()&&parseInt(getComputedStyle(this.el).width)<=1&&(this.el.style.width=\"100%\");var n=this.getContainerDimensions(this.el,this.options.noHeight);this.options.matchDPR&&(n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);var i=t.map(function(t){return t.score=e.calculateUsabilityScore(n.width,n.height,t.width,t.height),t});i.sort(function(e,t){return e.score-t.score});var r=i[i.length-1];this.loadImage(r.url,function(){e.loaded=!0,e.isLoading=!1,e.currentSize={width:r.width,height:r.height},e.el.classList.remove(e.config.classes.loading),e.el.classList.add(e.config.classes.loaded),a.default.emit(\"image-loaded\",e.el)})}}},{key:\"calculateUsabilityScore\",value:function(e,t,n,i){var r=1;return n>=e?r*=e/n:r-=Math.abs(e-n),t&&(i>=t?r*=t/i:r-=Math.abs(t-i)),r}},{key:\"getContainerDimensions\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={width:\"block\"==(this.el.style.display?this.el.style.display:window.getComputedStyle(this.el).display)?this.el.clientWidth:0,height:this.el.clientHeight?this.el.clientHeight:0};return t.width||(t.width=this.getElementWidth(this.el.parentElement)),e&&(t.height=0),t}},{key:\"getElementWidth\",value:function(e){return\"block\"!=(e.style.display?e.style.display:window.getComputedStyle(e).display)&&e.parentElement?this.getElementWidth(e.parentElement):e.clientWidth}},{key:\"loadImage\",value:function(e,t){var n=new Image,i=this.el;n.onload=function(){\"img\"===i.tagName.toLowerCase()?i.setAttribute(\"src\",this.src):i.style.backgroundImage=\"url('\"+this.src+\"')\",t&&\"function\"==typeof t&&t()},n.src=e}}],[{key:\"isCached\",value:function(e){return e.getAttribute(\"data-ib-cache-id\")&&!e.hasAttribute(\"data-ib-no-cache\")}},{key:\"shouldIgnore\",value:function(e){return e.hasAttribute(\"data-ib-ignore\")}}]),e}();t.default=u},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.enabled=t}return i(e,[{key:\"debug\",value:function(){var e;this.enabled&&(e=console).log.apply(e,arguments)}},{key:\"debugInfo\",value:function(){var e;this.enabled&&(e=console).info.apply(e,arguments)}},{key:\"debugTable\",value:function(){var e;this.enabled&&(e=console).table.apply(e,arguments)}}]),e}();t.default=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=u(n(1)),o=u(n(3)),a=u(n(2)),s=u(n(0));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.eventsRunning={},this.elementCache=[],this.elements={queue:[],loaded:[]},this.events=[],this.currentCacheId=0,this.config={events:{resize:\"ImageBuddyResize\",scroll:\"ImageBuddyScroll\"},attributes:{sources:\"data-ib-sources\",lazyLoad:\"data-ib-lazyload\",lazyLoadThreshold:\"data-ib-lazyload-threshold\",matchDPR:\"data-ib-match-dpr\",noHeight:\"data-ib-no-height\"},classes:{base:\"ib__image\",loading:\"ib__image--loading\",loaded:\"ib__image--loaded\"}},this.opts=Object.assign({debug:!1,matchDPR:!0,lazyLoad:!0,lazyLoadThreshold:100},t),this.debugger=new o.default(this.opts.debug),this.resizeHandler=this.resizeHandler.bind(this),this.scrollHandler=this.scrollHandler.bind(this),this.setupEventListeners(),this.update()}return i(e,[{key:\"processElementQueue\",value:function(){var e=0;if(!this.elements.queue.length)return e;for(var t=0;t<this.elements.queue.length;t++){var n=this.elements.queue[t];n.options.lazyLoad&&!1===n.canLazyLoad(n)||(n.chooseImage(),this.elements.queue.splice(t,1),this.elements.loaded.push(n),t--,e++)}return e}},{key:\"update\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=performance.now(),n=e.parentEl||document,i=this.getElements(n),r=e.updateOffsetTop||!1;if(this.elements.queue=this.elements.queue.concat(i),this.debugger.debugInfo(this.elements.queue),r)for(var o=0;o<this.elements.queue.length;o++)this.elements.queue[o].calculateElementTopOffset();var a=this.processElementQueue(),u=performance.now();this.debugger.debug(\"ImageBuddy: update complete\",a+\" elements\",Math.round(u-t)+\"ms\"),s.default.emit(\"update\")}},{key:\"setupEventListeners\",value:function(){r.default.throttleEventListener(\"resize\",this.resizeHandler,{passive:!0}),r.default.throttleEventListener(\"scroll\",this.scrollHandler,{passive:!0})}},{key:\"getElements\",value:function(e){for(var t=[],n=e.querySelectorAll(\"[\"+this.config.attributes.sources+\"]\"),i=0;i<n.length;i++){var r=n[i];a.default.isCached(r)||a.default.shouldIgnore(r)||t.push(new a.default(r,this.config,this.opts))}return t}},{key:\"resizeHandler\",value:function(){for(var e=0;e<this.elements.loaded.length;e++){var t=this.elements.loaded[e],n=t.getContainerDimensions();(n.width>t.currentSize.width||!t.noHeight&&n.height>t.currentSize.height)&&(this.debugger.debug(\"swapping image\"),t.chooseImage())}for(var i=0;i<this.elements.queue.length;i++)this.elements.queue[i].calculateElementTopOffset();this.processElementQueue()}},{key:\"scrollHandler\",value:function(){this.processElementQueue()}}],[{key:\"on\",value:function(e,t){s.default.on(e,t)}}]),e}();t.default=l},function(e,t,n){\"use strict\";var i=function(e){return e&&e.__esModule?e:{default:e}}(n(4));window.ImageBuddy=i.default}]);"],"mappings":"AAAA","sourceRoot":""}